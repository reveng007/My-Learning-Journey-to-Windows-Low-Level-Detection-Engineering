# Dissecting FlawedAmmyy: Static Analysis

## 1. Opening Sample in Hex Editor:

<details><summary>See Details</summary>

<img width="1396" height="690" alt="image" src="https://github.com/user-attachments/assets/c8af1d2f-2126-48d4-bb02-a11f23f9f32b" />

### Checking IAT in Hex Editor:
> ### We can see what are the probable API which can be used by the malware (all are imported but may happen some are not used.)

<img width="1536" height="941" alt="image" src="https://github.com/user-attachments/assets/5297228e-af15-4936-9678-40faa14c6852" />

### At the very End, we can see that a pattern is there, `6F` is being repeated and also random chars are present without presence of any spaces (Indicator of obfuscation/Encryption).

<img width="2143" height="1145" alt="image" src="https://github.com/user-attachments/assets/37bb9183-5116-4e6d-8c45-4fd60649e044" />

<img width="1399" height="696" alt="image" src="https://github.com/user-attachments/assets/660a3e19-e536-49c2-9c69-09453c87bcd9" />

### At the very End, we can see Manifest. It won't ask for Administrative Prompt/UAC Prompt.

<img width="1002" height="141" alt="image" src="https://github.com/user-attachments/assets/e720f37e-158c-47ab-8eb5-78db9b5f729e" />

</details>

## 2. String extractions:

<details><summary>See Details</summary>

### 1. Process Names, somehow may be related to `createtoolhelp32snapshot` WinAPI

<img width="1862" height="821" alt="image" src="https://github.com/user-attachments/assets/59827535-a938-407f-8704-1668cd3fe676" />

<img width="380" height="272" alt="image" src="https://github.com/user-attachments/assets/86715c8e-6d3b-4e11-ac95-0754537688c0" />

### This revelation of Window APIs here also says that API hashing type functions are not present in here. Check [Resources for learning about reversing API hashed binary](https://github.com/reveng007/My-Learning-Journey-to-Windows-Low-Level-Detection-Engineering/blob/main/1.Malware%20Analyst%20Professional%20-%20Level%201%20TrainSec/4.md#resources).

</details>

## 3. PE Parsing via PE Bear:

<details><summary>See Details</summary>

### 1. Rich Header Shows what type of linker and Compiler is used.

<img width="1948" height="1200" alt="image" src="https://github.com/user-attachments/assets/44484d64-a821-45fb-8669-09ece4a6cb92" />

### 2. Checking the Base Address from where the malware starts to execute : Image Base + Entry Point 

<img width="1945" height="1208" alt="image" src="https://github.com/user-attachments/assets/9ce89bb5-7236-4c49-8f83-49857bc08ed2" />

### 3. Under Section Headers: 2 `.rdata` Sections, which is Odd. On top of that, 1 `.rdata` (read data) has executable permission which is again sus.

<img width="1934" height="1180" alt="image" src="https://github.com/user-attachments/assets/88fe09dd-f661-47f4-bac3-19666e12ece8" />

### 4. Under Section Headers: Size of the `.rsrc` (resource) section (raw size as well as the Virtual Size) is relatively bigger than the other sections -> SUS!.

<img width="1940" height="1211" alt="image" src="https://github.com/user-attachments/assets/ef301fde-03b3-4d4a-adfa-f9511fd266f3" />

#### Raw Size = Size on the File System/Disk 
#### Virtual Size = Size in the Runtime Memory

### 5. Under Imports: We can see different dlls

<img width="1944" height="1174" alt="image" src="https://github.com/user-attachments/assets/105ab3a9-2979-404c-ba42-5e24d8d76669" />

#### This shows that there is probability of this malware to take screenshots (Needs further validation of usage of these APIs)
<img width="1944" height="1174" alt="image" src="https://github.com/user-attachments/assets/a83c8a69-05f5-44b2-9793-51409cb4abda" />

> SetDIBits: https://learn.microsoft.com/en-us/windows/win32/api/wingdi/nf-wingdi-setdibits

> createdcw: https://www.google.com/search?q=createdcw+screenshot&sxsrf=AE3TifOWSeIpzjnqvIelA45fslZXlO5dmA%3A1764451359119

#### 6. Under Imports: Presence of `winspool.drv` (Client-side functions of the Print Spooler)

<img width="1945" height="1176" alt="image" src="https://github.com/user-attachments/assets/ab7fea9c-5d1e-4d84-80cf-964e20247fbe" />

##### It might gives us a suspicion that `spoolsv.exe` - Windows Print Spooler service process may be exploited here. It may be ! but in this case there is no such exploitation. So it depends, presence of `WINSPOOL.DRV` doesn't mean exploitation of _spoolsv.exe_.

</details>

## Resources:
1. Malware Analysis : [YT - Malware Evasion Techniques: API Unhooking + API Hashing](https://www.youtube.com/watch?v=mjF9LFIAgF8)
